service cloud.firestore {
  match /databases/{database}/documents {
    match /{document=**} {
      function isSignedIn() {
        return request.auth != null;
      }

      function getRole(rsc) {
        // Read from the "roles" map in the resource (rsc).
        return rsc.data.roles[request.auth.uid];
      }

			function isOneOfRoles(rsc, array) {
        // Determine if the user is one of an array of roles
        return isSignedIn() && (getRole(rsc) in array);
      }
        
  		allow read;
  		allow write: if isSignedIn() || isOneOfRoles(resource, ['admin', 'editor', 'subscriber']);
		  allow delete: if getRole('admin') == true;
    }
  }
}